---
title: "Phase 12.4: Polish + Additional Capabilities"
type: feat
status: pending
date: 2026-02-27
parent: docs/plans/2026-02-27-feat-mobile-dev-cockpit-plan.md
depends_on: Phase 12.1, Phase 12.2, Phase 12.3
brainstorm: docs/brainstorms/2026-02-27-mobile-dev-cockpit-brainstorm.md
---

# Phase 12.4: Polish + Additional Capabilities

## Overview

Round out the mobile dev cockpit with commonly needed development workflows: PR lifecycle commands, branch management, and first-time onboarding.

## Prerequisites

- Phase 12.1 complete (command routing, SQLite, VM endpoints)
- Phase 12.2 complete (output rendering â€” PR status benefits from smart formatting)
- Phase 12.3 complete (slash commands â€” PR/branch commands register as Discord slash commands)

## Technical Approach

### PR Lifecycle Commands

New VM action-commands routed via relay, same pattern as `clone`/`switch`:

| Command | Endpoint | Action | Implementation |
|---------|----------|--------|---------------|
| `pr create` | POST `/pr/create` | Create PR from current branch | `gh pr create --fill` |
| `pr status` | GET `/pr/status` | Show CI status, review state | `gh pr status` |
| `pr merge` | POST `/pr/merge` | Merge current PR | `gh pr merge --auto` |

Relay command router additions:

```javascript
const prCreateMatch = lower.match(/^pr\s+create$/);
if (prCreateMatch) return { type: 'action', command: 'pr-create' };

const prStatusMatch = lower.match(/^pr\s+status$/);
if (prStatusMatch) return { type: 'action', command: 'pr-status' };

const prMergeMatch = lower.match(/^pr\s+merge$/);
if (prMergeMatch) return { type: 'action', command: 'pr-merge' };
```

### Branch Management

| Command | Endpoint | Action |
|---------|----------|--------|
| `branch` | GET `/branch` | List branches, mark current |
| `checkout <name>` | POST `/checkout` | Switch branch |
| `checkout -b <name>` | POST `/checkout` | Create + switch |

Relay command router additions:

```javascript
if (lower === 'branch') return { type: 'action', command: 'branch' };

const checkoutMatch = trimmed.match(/^checkout\s+(-b\s+)?(\S+)/i);
if (checkoutMatch) return { type: 'action', command: 'checkout', args: { create: !!checkoutMatch[1], name: checkoutMatch[2] } };
```

### Onboarding Flow

On first interaction (no repos cloned, no cwd set):

```
ðŸ‘‹ Welcome to your development cockpit!

Get started:
  clone <repo-url>  â€” Clone a repository
  help              â€” See all commands

Your VM is ready at /data/repos/. Clone a repo to begin.
```

**Trigger:** When `config` table has no `cwd` key, or cwd points to non-existent directory.

**Logic:** Add an `isOnboarded()` check in the relay's action-command handler. If not onboarded and the command is freeform, prepend the welcome message. Only show once â€” set `config.onboarded = true` after first display.

### Discord Slash Command Registration

Register new commands alongside Phase 12.3's core commands:
- `/pr create`, `/pr status`, `/pr merge`
- `/branch`, `/checkout`

### Help Output Update

Add new commands to help output:

```
ðŸ“‹ Core Commands
  clone <url>    â€” Clone a repo
  switch <name>  â€” Switch repo
  repos          â€” List repos
  status         â€” Current state
  branch         â€” List branches
  checkout <name> â€” Switch branch
  pr create      â€” Create PR
  pr status      â€” CI/review status
  pr merge       â€” Merge current PR
  help           â€” Show this help
  cancel/approve/reject â€” Control flow
```

## Implementation Tasks

- [ ] Add `pr create`, `pr status`, `pr merge` to relay command router
- [ ] Add VM endpoints: POST `/pr/create`, GET `/pr/status`, POST `/pr/merge`
- [ ] Add `branch`, `checkout` to relay command router
- [ ] Add VM endpoints: GET `/branch`, POST `/checkout`
- [ ] Implement onboarding flow (detect first interaction, show welcome)
- [ ] Store `onboarded` flag in SQLite config table
- [ ] Register new slash commands in Discord adapter
- [ ] Update help output with new commands
- [ ] Update Phase 12.3's `updateSlashCommands()` to include PR/branch commands

## Acceptance Criteria

- [ ] `pr create`, `pr status`, `pr merge` work from phone
- [ ] `branch`, `checkout` commands work
- [ ] First-time users see onboarding message
- [ ] Onboarding only shows once (persisted in config)
- [ ] New commands appear in `help` output
- [ ] New commands registered as Discord slash commands
- [ ] Anti-collision: `pr create a button` does NOT trigger pr create

## Dependencies

| Dependency | Notes |
|-----------|-------|
| Phase 12.1 | Command routing, SQLite, VM endpoint pattern |
| Phase 12.2 | Smart formatting for PR status output |
| Phase 12.3 | Slash command registration |
| `gh` CLI on VM | Already available in Docker image (via Claude Code) |

## Key References

- Command router: `relay-core.js` classifyCommand() (from Phase 12.1)
- VM endpoint pattern: `/clone`, `/switch` (from Phase 12.1)
- Discord slash commands: `adapters/discord.js` (from Phase 12.3)
- GitHub CLI: `gh pr create`, `gh pr status`, `gh pr merge`
